# QUแบขN Lร Hแป THแปNG THรNG TIN ฤแปA ฤIแปM DU LแปCH
- Tรกc giแบฃ: Vi Tuแบฅn ฤแบกt
- MSSV: K215480106088
- Lแปp: K57KMT
- Ngรy lรm: 2024-06-13
## Chแปฉc Nฤng Cฦก Bแบฃn
### 1. Quแบฃn lรฝ
1.1.Quแบฃn Lรฝ ฤแปa ฤiแปm Du Lแปch
- Thรชm ฤแปa ฤiแปm du lแปch: Cho phรฉp thรชm mแปi mแปt ฤแปa ฤiแปm du lแปch vรo cฦก sแป dแปฏ liแปu
- Sแปญa thรดng tin ฤแปa ฤiแปm du lแปch: Cho phรฉp chแปnh sแปญa thรดng tin cแปงa mแปt ฤแปa ฤiแปm du lแปch ฤรฃ tแปn tแบกi
- Xรณa ฤแปa ฤiแปm du lแปch: Cho phรฉp xรณa mแปt ฤแปa ฤiแปm du lแปch khแปi cฦก sแป dแปฏ liแปu
- Xem danh sรกch ฤแปa ฤiแปm du lแปch: Hiแปn thแป danh sรกch tแบฅt cแบฃ cรกc ฤแปa ฤiแปm du lแปch

1.2. Quแบฃn Lรฝ Khรกch Sแบกn 
- Thรชm khรกch sแบกn: Cho phรฉp thรชm mแปi mแปt khรกch sแบกn vรo cฦก sแป dแปฏ liแปu
- Sแปญa thรดng tin khรกch sแบกn: Cho phรฉp chแปnh sแปญa thรดng tin cแปงa mแปt khรกch sแบกn ฤรฃ tแปn tแบกi
- Xรณa khรกch sแบกn: Cho phรฉp xรณa mแปt khรกch sแบกn khแปi cฦก sแป dแปฏ liแปu
- Xem danh sรกch khรกch sแบกn: Hiแปn thแป danh sรกch tแบฅt cแบฃ cรกc khรกch sแบกn

1.3. Quแบฃn Lรฝ Nhร Hรng
- Thรชm nhร hรng: Cho phรฉp thรชm mแปi mแปt nhร hรng vรo cฦก sแป dแปฏ liแปu
- Sแปญa thรดng tin nhร hรng: Cho phรฉp chแปnh sแปญa thรดng tin cแปงa mแปt nhร hรng ฤรฃ tแปn tแบกi
- Xรณa nhร hรng: Cho phรฉp xรณa mแปt nhร hรng khแปi cฦก sแป dแปฏ liแปu
- Xem danh sรกch nhร hรng: Hiแปn thแป danh sรกch tแบฅt cแบฃ cรกc nhร hรng

1.4. Quแบฃn Lรฝ ฤรกnh Giรก
- Thรชm ฤรกnh giรก: Cho phรฉp thรชm mแปi mแปt ฤรกnh giรก tแปซ khรกch hรng vแป ฤแปa ฤiแปm du lแปch
- Sแปญa thรดng tin ฤรกnh giรก: Cho phรฉp chแปnh sแปญa thรดng tin cแปงa mแปt ฤรกnh giรก ฤรฃ tแปn tแบกi
- Xรณa ฤรกnh giรก: Cho phรฉp xรณa mแปt ฤรกnh giรก khแปi cฦก sแป dแปฏ liแปu
- Xem danh sรกch ฤรกnh giรก: Hiแปn thแป danh sรกch tแบฅt cแบฃ cรกc ฤรกnh giรก

1.5. Quแบฃn Lรฝ Khรกch Hรng
- Thรชm khรกch hรng: Cho phรฉp thรชm mแปi mแปt khรกch hรng vรo cฦก sแป dแปฏ liแปu
- Sแปญa thรดng tin khรกch hรng: Cho phรฉp chแปnh sแปญa thรดng tin cแปงa mแปt khรกch hรng ฤรฃ tแปn tแบกi
- Xรณa khรกch hรng: Cho phรฉp xรณa mแปt khรกch hรng khแปi cฦก sแป dแปฏ liแปu.
- Xem danh sรกch khรกch hรng: Hiแปn thแป danh sรกch tแบฅt cแบฃ cรกc khรกch hรng

### 2. Chแปฉc Nฤng Truy Vแบฅn
- Tรฌm kiแบฟm ฤแปa ฤiแปm du lแปch theo tรชn hoแบทc loแบกi hรฌnh du lแปch
- Tรฌm kiแบฟm khรกch sแบกn hoแบทc nhร hรng theo ฤแปa ฤiแปm du lแปch
- Xem chi tiแบฟt ฤรกnh giรก cแปงa mแปt ฤแปa ฤiแปm du lแปch cแปฅ thแป
- Xem chi tiแบฟt thรดng tin khรกch hรng
### 3. Chแปฉc Nฤng Nรขng Cao
3.1. Trigger
- Cแบญp nhแบญt tแปng sแป sao vร sแป lฦฐแปฃng ฤรกnh giรก: Tแปฑ ฤแปng cแบญp nhแบญt tแปng sแป sao vร sแป lฦฐแปฃng ฤรกnh giรก cแปงa mแปt ฤแปa ฤiแปm du lแปch khi cรณ ฤรกnh giรก mแปi ฤฦฐแปฃc thรชm vรo hoแบทc khi mแปt ฤรกnh giรก bแป xรณa hoแบทc chแปnh sแปญa.

3.2. Cursor
- Duyแปt qua cรกc ฤแปa ฤiแปm du lแปch: Tแบกo thแปง tแปฅc lฦฐu trแปฏ ฤแป duyแปt qua cรกc ฤแปa ฤiแปm du lแปch vร thแปฑc hiแปn cรกc tรญnh toรกn tแปng hแปฃp nhฦฐ sแป lฦฐแปฃng khรกch sแบกn hoแบทc nhร hรng tแบกi mแปi ฤแปa ฤiแปm.

3.3. Bรกo Cรกo vร Thแปng Kรช
- Bรกo cรกo ฤแปa ฤiแปm du lแปch phแป biแบฟn: Tแบกo bรกo cรกo hiแปn thแป cรกc ฤแปa ฤiแปm du lแปch phแป biแบฟn dแปฑa trรชn sแป lฦฐแปฃng ฤรกnh giรก vร ฤiแปm sแป trung bรฌnh.
## Thiแบฟt kแบฟ chฦฐฦกng trรฌnh trong SQL
### 1. Tแบกo cรกc bแบฃng
Bแบฃng KhachHang (Phแบฃi tแบกo ฤแบงu tiรชn ฤแป cรกc bแบฃng khรกc tham chiแบฟu tแปi)
- ID๐: Khรณa chรญnh ฤฦฐแปฃc sแปญ dแปฅng ฤแป xรกc ฤแปnh mแปi khรกch hรng mแปt cรกch duy nhแบฅt, tแปฑ tฤng.
- TenKhachHang: Tรชn khรกch hรng ฤฦฐแปฃc ฤแบทt lร NOT NULL ฤแป ฤแบฃm bแบฃo mแปi khรกch hรng ฤฦฐแปฃc lฦฐu trแปฏ ฤแปu cรณ thรดng tin tรชn. ฤiแปu nรy cแปฑc kแปณ quan trแปng ฤแป cรณ thแป phรขn biแปt vร quแบฃn lรฝ cรกc khรกch hรng.
- Email: Email cแปงa khรกch hรng.
- SoDienThoai: Sแป ฤiแปn thoแบกi cแปงa khรกch hรng.

![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/4bccf9e6-bc3c-42e9-b17c-32b969ba51b6)
  
Bแบฃng DiaDiemDuLich
- ID๐: Khรณa chรญnh, tแปฑ tฤng.
- TenDiaDiem: Tรชn ฤแปa ฤiแปm du lแปch lร thรดng tin cแบงn thiแบฟt vร ฤฦฐแปฃc ฤรกnh dแบฅu lร NOT NULL ฤแป ฤแบฃm bแบฃo tรญnh chรญnh xรกc vร ฤแบงy ฤแปง cแปงa dแปฏ liแปu.
- MoTa: Mรด tแบฃ vแป ฤแปa ฤiแปm.
- DiaChi: ฤแปa chแป ฤแปa ฤiแปm.
- LoaiHinhDuLich: Loแบกi hรฌnh du lแปch (nghแป dฦฐแปกng, tham quan, ...).

![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/bf0754f9-8ea6-4529-86b4-751b0b60bcb9)

Bแบฃng KhachSan
- ID๐: Khรณa chรญnh, tแปฑ tฤng.
- TenKhachSan: Tรชn khรกch sแบกn ฤฦฐแปฃc ฤรกnh dแบฅu lร NOT NULL ฤแป ฤแบฃm bแบฃo tรญnh duy nhแบฅt cแปงa dแปฏ liแปu.
- DiaChi: ฤแปa chแป khรกch sแบกn.
- SoSao: Sแป sao cแปงa khรกch sแบกn.
- DiaDiemID๐: Lร khรณa ngoแบกi (FOREIGN KEY) tham chiแบฟu ฤแบฟn ID cแปงa bแบฃng DiaDiemDuLich. ฤiแปu nรy thiแบฟt lแบญp mแปi quan hแป giแปฏa cรกc bแบฃng vร cho phรฉp truy cแบญp thรดng tin vแป ฤแปa ฤiแปm du lแปch liรชn quan tแปi tแปซng khรกch sแบกn vร nhร hรng.

 ![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/fa99a22a-75aa-4c9e-9272-5639b64e98d6)

Bแบฃng NhaHang
- ID๐: Khรณa chรญnh, tแปฑ tฤng.
- TenNhaHang: Tรชn nhร hรng ฤฦฐแปฃc ฤรกnh dแบฅu lร NOT NULL ฤแป ฤแบฃm bแบฃo tรญnh duy nhแบฅt cแปงa dแปฏ liแปu.
- DiaChi: ฤแปa chแป nhร hรng.
- LoaiHinhAmThuc: Loแบกi hรฌnh แบฉm thแปฑc (รu, ร, Hแบฃi sแบฃn, ...).
- DiaDiemID๐:  Lร khรณa ngoแบกi (FOREIGN KEY) tham chiแบฟu ฤแบฟn ID cแปงa bแบฃng DiaDiemDuLich. ฤiแปu nรy thiแบฟt lแบญp mแปi quan hแป giแปฏa cรกc bแบฃng vร cho phรฉp truy cแบญp thรดng tin vแป ฤแปa ฤiแปm du lแปch liรชn quan tแปi tแปซng khรกch sแบกn vร nhร hรng.

 ![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/0e1d530f-2396-4cc1-b8d1-89e7147d47da)

Bแบฃng DanhGia
- ID๐: Khรณa chรญnh, tแปฑ tฤng.
- KhachHangID๐: Lร khรณa ngoแบกi (FOREIGN KEY) tham chiแบฟu ฤแบฟn ID cแปงa bแบฃng KhachHang. ฤiแปu nรy thiแบฟt lแบญp mแปi quan hแป giแปฏa bแบฃng DanhGia.
- DiaDiemID๐: Lร khรณa ngoแบกi (FOREIGN KEY) tham chiแบฟu ฤแบฟn ID cแปงa bแบฃng DiaDiemDuLich. ฤiแปu nรy thiแบฟt lแบญp mแปi quan hแป giแปฏa cรกc bแบฃng vร cho phรฉp truy cแบญp thรดng tin vแป ฤแปa ฤiแปm du lแปch liรชn quan tแปi tแปซng khรกch sแบกn vร nhร hรng.
- SoSao: Sแป sao ฤรกnh giรก.
- BinhLuan: Bรฌnh luแบญn cแปงa khรกch hรng.

![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/37720870-2e99-43db-935c-ab8077953198)

Sฦก ฤแป thแปฑc thแป liรชn kแบฟt

![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/a91efec1-cfd9-4152-9930-90d3637f4929)

### 2.Thรชm dแปฏ liแปu vรo cรกc bแบฃng

-- Thรชm dแปฏ liแปu vรo bแบฃng DiaDiemDuLich

INSERT INTO DiaDiemDuLich (TenDiaDiem, MoTa, DiaChi, LoaiHinhDuLich) VALUES

(N'ฤร Lแบกt', N'Thรnh phแป ngรn hoa', N'Lรขm ฤแปng', N'Nghแป dฦฐแปกng'),

(N'Hแบก Long', N'Vแปnh biแปn ฤแบนp nhแบฅt', N'Quแบฃng Ninh', N'Tham quan');

-- Thรชm dแปฏ liแปu vรo bแบฃng KhachSan

INSERT INTO KhachSan (TenKhachSan, DiaChi, SoSao, DiaDiemID) VALUES

(N'Khรกch sแบกn ฤร Lแบกt Palace', N'Sแป 12, ฤฦฐแปng Trแบงn Phรบ', 5, 1),

(N'Khรกch sแบกn Mฦฐแปng Thanh', N'Sแป 1, ฤฦฐแปng Hแบก Long', 4, 2);

-- Thรชm dแปฏ liแปu vรo bแบฃng NhaHang

INSERT INTO NhaHang (TenNhaHang, DiaChi, LoaiHinhAmThuc, DiaDiemID) VALUES

(N'Nhร hรng Hoa ฤร Lแบกt', N'Sแป 15, ฤฦฐแปng Phan Bแปi Chรขu', N'รu', 1),

(N'Nhร hรng Biแปn Vรng', N'Sแป 3, ฤฦฐแปng Bรฃi Chรกy', N'Hแบฃi sแบฃn', 2);

-- Thรชm dแปฏ liแปu vรo bแบฃng KhachHang

INSERT INTO KhachHang (TenKhachHang, Email, SoDienThoai) VALUES

(N'Nguyแปn Vฤn A', N'vana@gmail.com', N'0901234567'),

(N'Trแบงn Thแป B', N'thib@gmail.com', N'0912345678');


-- Thรชm dแปฏ liแปu vรo bแบฃng DanhGia

INSERT INTO DanhGia (KhachHangID, DiaDiemID, SoSao, BinhLuan) VALUES

(1, 1, 5, N'Rแบฅt ฤแบนp vร thฦก mแปng!'),

(2, 2, 4, N'Cแบฃnh ฤแบนp nhฦฐng dแปch vแปฅ chฦฐa tแปt.');

## Thiแบฟt lแบญp chแปฉc nฤng
### 1.Chแปฉc nฤng cฦก bแบฃn
1.1.Chแปฉc nฤng tรฌm kiแบฟm thรดng tin

*Lแบฅy danh sรกch cรกc ฤแปa diแปm du lแปch:

SELECT * FROM DiaDiemDuLich;

*Lแบฅy danh sรกch cรกc khรกch sแบกn:

SELECT * FROM KhachSan WHERE DiaDiemID = (id cแปงa ฤแปa ฤiแปm cแบงn tรฌm);

*Lแบฅy danh sรกch cรกc nhร hรng

	SELECT * FROM NhaHang WHERE DiaDiemID = (id cแปงa ฤแปa ฤiแปm cแบงn tรฌm);
 
*Lแบฅy danh sรกch ฤรกnh giรก cho 1 ฤแปa ฤiแปm:

	SELECT * FROM DanhGia WHERE DiaDiemID = (id cแปงa ฤแปa ฤiแปm cแบงn tรฌm);
 
*Lแบฅy thรดng tin chi tiแบฟt cแปงa 1 khรกch hรng:

	SELECT * FROM KhachHang WHERE ID = (id cแปงa khรกch hรng);
 
1.2.Chแปฉc nฤng thรชm, xรณa, sแปญa

- ฤแปa ฤiแปm du lแปch

![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/8e0c990c-28c0-4e22-8c57-d2d9096fd8b9)

- Khรกch sแบกn

![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/8b328396-f8d0-419d-9dbc-ece655c8f5a2)

- Nhร hรng

![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/f2e64397-acad-4159-b5a8-137177b3ab28)

- ฤรกnh giรก

![image](https://github.com/TuanDat23/BTL_HQTCSDL_QuanLyDiaThongTinDiemDuLich/assets/168843736/6b052614-1553-4001-a898-2a2a5c6a221c)

### 2.Chแปฉc nฤng nรขng cao
- Tแปฑ ฤแปng cแบญp nhแบญt tแปng sแป sao vร sแป lฦฐแปฃng ฤรกnh giรก cแปงa mแปt ฤแปa ฤiแปm du lแปch khi cรณ ฤรกnh giรก mแปi

CREATE TRIGGER trg_UpdateReviewStats

ON DanhGia

AFTER INSERT, UPDATE, DELETE

AS

BEGIN

    -- Xแปญ lรฝ cho trฦฐแปng hแปฃp thรชm hoแบทc cแบญp nhแบญt ฤรกnh 
    
    IF EXISTS (SELECT * FROM inserted)
    
    BEGIN
    
        DECLARE @DiaDiemID INT;
	
        SELECT @DiaDiemID = DiaDiemID FROM inserted;

        DECLARE @TotalStars INT;
	
        SELECT @TotalStars = SUM(SoSao) FROM DanhGia WHERE DiaDiemID = @DiaDiemID;

        DECLARE @ReviewCount INT;
	
        SELECT @ReviewCount = COUNT(*) FROM DanhGia WHERE DiaDiemID = @DiaDiemID;

        UPDATE DiaDiemDuLich
	
        SET TongSoSao = @TotalStars, SoLuongDanhGia = @ReviewCount
	
        WHERE ID = @DiaDiemID;
	
    END;

    -- Xแปญ lรฝ cho trฦฐแปng hแปฃp xรณa ฤรกnh giรก
    
    IF EXISTS (SELECT * FROM deleted)
    
    BEGIN
    
        DECLARE @DiaDiemIDDel INT;
	
        SELECT @DiaDiemIDDel = DiaDiemID FROM deleted;

        DECLARE @TotalStarsDel INT;
	
        SELECT @TotalStarsDel = SUM(SoSao) FROM DanhGia WHERE DiaDiemID = @DiaDiemIDDel;

        DECLARE @ReviewCountDel INT;
	
        SELECT @ReviewCountDel = COUNT(*) FROM DanhGia WHERE DiaDiemID = @DiaDiemIDDel;

        UPDATE DiaDiemDuLich
	
        SET TongSoSao = @TotalStarsDel, SoLuongDanhGia = @ReviewCountDel
	
        WHERE ID = @DiaDiemIDDel;
	
    END;
    
END;

- Duyแปt qua cรกc ฤแปa ฤiแปm du lแปch vร in ra tรชn ฤแปa ฤiแปm vร sแป lฦฐแปฃng khรกch sแบกn tแบกi ฤรณ

CREATE PROCEDURE ListHotelsPerLocation

AS

BEGIN

    DECLARE @locationID INT;
    
    DECLARE @locationName NVARCHAR(255);

        DECLARE location_cursor CURSOR FOR
	
        SELECT ID, TenDiaDiem FROM DiaDiemDuLich;

    OPEN location_cursor;

    FETCH NEXT FROM location_cursor INTO @locationID, @locationName;

    -- Duyแปt qua cรกc ฤแปa ฤiแปm du lแปch
    
    WHILE @@FETCH_STATUS = 0
    
    BEGIN
    
        -- In ra tรชn ฤแปa ฤiแปm vร sแป lฦฐแปฃng khรกch sแบกn tแบกi ฤรณ
	
        PRINT 'ฤแปa ฤiแปm: ' + @locationName + ' - Sแป lฦฐแปฃng khรกch sแบกn: ' + CAST((SELECT COUNT(*) FROM KhachSan WHERE DiaDiemID = @locationID) AS NVARCHAR(10));

        FETCH NEXT FROM location_cursor INTO @locationID, @locationName;
	
    END;
    

    CLOSE location_cursor;
    
    DEALLOCATE location_cursor;
    
END;

- Tรฌm kiแบฟm thรดng tin

-- Tแบกo mแปt VIEW mแปi cรณ tรชn 'View_HotelInfo'

CREATE VIEW View_HotelInfo AS

SELECT 

    ks.ID, -- ID cแปงa khรกch sแบกn
    
    ks.TenKhachSan, -- Tรชn cแปงa khรกch sแบกn
    
    ks.DiaChi, -- ฤแปa chแป cแปงa khรกch sแบกn
    
    ks.DiaDiemID, -- ID cแปงa ฤแปa ฤiแปm du lแปch liรชn kแบฟt vแปi khรกch sแบกn
    
    dd.TenDiaDiem, -- Tรชn cแปงa ฤแปa ฤiแปm du lแปch
    
    ISNULL(AVG(dg.SoSao), 0) AS TrungBinhSoSao -- Tรญnh trung bรฌnh sแป sao cแปงa cรกc ฤรกnh giรก, nแบฟu khรดng cรณ ฤรกnh giรก nรo thรฌ trแบฃ vแป 0
    
FROM 

    KhachSan ks -- Bแบฃng KhachSan
    
LEFT JOIN 

    DiaDiemDuLich dd ON ks.DiaDiemID = dd.ID -- Kแบฟt nแปi bแบฃng DiaDiemDuLich ฤแป lแบฅy tรชn ฤแปa ฤiแปm du lแปch
    
LEFT JOIN 

    DanhGia dg ON ks.ID = dg.DiaDiemID -- Kแบฟt nแปi bแบฃng DanhGia ฤแป lแบฅy cรกc ฤรกnh giรก liรชn quan ฤแบฟn khรกch sแบกn
    
GROUP BY 

    ks.ID, ks.TenKhachSan, ks.DiaChi, ks.DiaDiemID, dd.TenDiaDiem; -- Nhรณm theo cรกc cแปt cแบงn thiแบฟt ฤแป tรญnh trung bรฌnh sแป sao
    
GO

SELECT * 

FROM View_HotelInfo

ORDER BY TrungBinhSoSao DESC, TenKhachSan ASC;


